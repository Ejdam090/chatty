{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";import _toConsumableArray from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _templateObject;import React,{useEffect,useState,useRef}from\"react\";import styled from\"styled-components\";import ChatInput from\"./ChatInput\";import Logout from\"./Logout\";import{v4 as uuidv4}from\"uuid\";import axios from\"axios\";import{getAllMessageRoute,sendMessageRoute}from\"../utils/APIRoutes\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ChatContainer=function ChatContainer(_ref){var currentChat=_ref.currentChat,socket=_ref.socket;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),arrivalMessage=_useState4[0],setArrivalMessage=_useState4[1];var scrollRef=useRef();useEffect(function(){var fetchCurrentChat=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!currentChat){_context.next=8;break;}_context.next=3;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY));case 3:data=_context.sent;_context.next=6;return axios.post(getAllMessageRoute,{from:data._id,to:currentChat._id});case 6:response=_context.sent;setMessages(response.data);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchCurrentChat(){return _ref2.apply(this,arguments);};}();fetchCurrentChat();},[currentChat]);useEffect(function(){var fetchCurrentChat=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!currentChat){_context2.next=3;break;}_context2.next=3;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY))._id;case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchCurrentChat(){return _ref3.apply(this,arguments);};}();fetchCurrentChat();},[currentChat]);var handleSendMsg=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(msg){var data,msgs;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY));case 2:data=_context3.sent;socket.current.emit(\"send-msg\",{to:currentChat._id,from:data._id,msg:msg});_context3.next=6;return axios.post(sendMessageRoute,{from:data._id,to:currentChat._id,message:msg});case 6:msgs=_toConsumableArray(messages);msgs.push({fromSelf:true,message:msg});setMessages(msgs);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSendMsg(_x){return _ref4.apply(this,arguments);};}();useEffect(function(){if(socket.current){socket.current.on(\"msg-recieve\",function(msg){setArrivalMessage({fromSelf:false,message:msg});});}},[]);useEffect(function(){arrivalMessage&&setMessages(function(prev){return[].concat(_toConsumableArray(prev),[arrivalMessage]);});},[arrivalMessage]);useEffect(function(){var _scrollRef$current;(_scrollRef$current=scrollRef.current)===null||_scrollRef$current===void 0?void 0:_scrollRef$current.scrollIntoView({behavior:\"smooth\"});},[messages]);return/*#__PURE__*/_jsx(_Fragment,{children:currentChat&&/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"avatar\",children:/*#__PURE__*/_jsx(\"img\",{src:\"data:image/svg+xml; base64, \".concat(currentChat.avatarImage),alt:\"avatar\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"username\",children:/*#__PURE__*/_jsx(\"h3\",{children:currentChat.username})})]}),/*#__PURE__*/_jsx(Logout,{})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-message\",children:messages.map(function(message){return/*#__PURE__*/_jsx(\"div\",{ref:scrollRef,children:/*#__PURE__*/_jsx(\"div\",{className:\"message \".concat(message.fromSelf?\"sended\":\"recieved\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"content\",children:/*#__PURE__*/_jsx(\"p\",{children:message.message})})})},uuidv4());})}),/*#__PURE__*/_jsx(ChatInput,{handleSendMsg:handleSendMsg})]})});};var Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  padding-top: 1rem;\\n  display: grid;\\n  grid-template-rows: 10% 78% 12%;\\n  .chat-header {\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n    padding: 0 2rem;\\n    .user-details {\\n      display: flex;\\n      align-items: center;\\n      gap: 1rem;\\n      .avatar {\\n        img {\\n          height: 3rem;\\n        }\\n      }\\n      .username {\\n        h3 {\\n          color: white;\\n        }\\n      }\\n    }\\n  }\\n  .chat-message {\\n    padding: 1rem 2rem;\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n    overflow: auto;\\n    &::-webkit-scrollbar {\\n      width: 0.2rem;\\n      &-thumb {\\n        background-color: #ffffff39;\\n        width: 0.1rem;\\n        border-radius: 1rem;\\n      }\\n    }\\n    .message {\\n      display: flex;\\n      align-items: center;\\n      .content {\\n        max-width: 40%;\\n        overflow-wrap: break-word;\\n        padding: 1rem;\\n        font-size: 1.1rem;\\n        border-radius: 1rem;\\n        color: #d1d1d1;\\n      }\\n    }\\n    .sended {\\n      justify-content: flex-end;\\n      .content {\\n        background-color: #4f04ff21;\\n      }\\n    }\\n    .recieved {\\n      justify-content: flex-start;\\n      .content {\\n        background-color: #9900ff20;\\n      }\\n    }\\n  }\\n\"])));export default ChatContainer;","map":{"version":3,"names":["React","useEffect","useState","useRef","styled","ChatInput","Logout","v4","uuidv4","axios","getAllMessageRoute","sendMessageRoute","ChatContainer","currentChat","socket","messages","setMessages","arrivalMessage","setArrivalMessage","scrollRef","fetchCurrentChat","JSON","parse","localStorage","getItem","process","env","REACT_APP_LOCALHOST_KEY","data","post","from","_id","to","response","handleSendMsg","msg","current","emit","message","msgs","push","fromSelf","on","prev","scrollIntoView","behavior","avatarImage","username","map","Container","div"],"sources":["C:/Users/Adam/Desktop/Apki/chat-box/src/components/ChatContainer.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport ChatInput from \"./ChatInput\";\r\nimport Logout from \"./Logout\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport axios from \"axios\";\r\nimport { getAllMessageRoute, sendMessageRoute } from \"../utils/APIRoutes\";\r\nconst ChatContainer = ({ currentChat, socket }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [arrivalMessage, setArrivalMessage] = useState(null);\r\n  const scrollRef = useRef();\r\n\r\n  useEffect(() => {\r\n    const fetchCurrentChat = async () => {\r\n      if (currentChat) {\r\n        const data = await JSON.parse(\r\n          localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)\r\n        );\r\n        const response = await axios.post(getAllMessageRoute, {\r\n          from: data._id,\r\n          to: currentChat._id,\r\n        });\r\n        setMessages(response.data);\r\n      }\r\n    };\r\n\r\n    fetchCurrentChat();\r\n  }, [currentChat]);\r\n  useEffect(() => {\r\n    const fetchCurrentChat = async () => {\r\n      if (currentChat) {\r\n        await JSON.parse(\r\n          localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)\r\n        )._id;\r\n      }\r\n    };\r\n    fetchCurrentChat();\r\n  }, [currentChat]);\r\n  const handleSendMsg = async (msg) => {\r\n    const data = await JSON.parse(\r\n      localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)\r\n    );\r\n    socket.current.emit(\"send-msg\", {\r\n      to: currentChat._id,\r\n      from: data._id,\r\n      msg,\r\n    });\r\n    await axios.post(sendMessageRoute, {\r\n      from: data._id,\r\n      to: currentChat._id,\r\n      message: msg,\r\n    });\r\n    const msgs = [...messages];\r\n    msgs.push({ fromSelf: true, message: msg });\r\n    setMessages(msgs);\r\n  };\r\n  useEffect(() => {\r\n    if (socket.current) {\r\n      socket.current.on(\"msg-recieve\", (msg) => {\r\n        setArrivalMessage({ fromSelf: false, message: msg });\r\n      });\r\n    }\r\n  }, []);\r\n  useEffect(() => {\r\n    arrivalMessage && setMessages((prev) => [...prev, arrivalMessage]);\r\n  }, [arrivalMessage]);\r\n  useEffect(() => {\r\n    scrollRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n  return (\r\n    <>\r\n      {currentChat && (\r\n        <Container>\r\n          <div className=\"chat-header\">\r\n            <div className=\"user-details\">\r\n              <div className=\"avatar\">\r\n                <img\r\n                  src={`data:image/svg+xml; base64, ${currentChat.avatarImage}`}\r\n                  alt=\"avatar\"\r\n                />\r\n              </div>\r\n              <div className=\"username\">\r\n                <h3>{currentChat.username}</h3>\r\n              </div>\r\n            </div>\r\n            <Logout />\r\n          </div>\r\n          <div className=\"chat-message\">\r\n            {messages.map((message) => {\r\n              return (\r\n                <div ref={scrollRef} key={uuidv4()}>\r\n                  <div\r\n                    className={`message ${\r\n                      message.fromSelf ? \"sended\" : \"recieved\"\r\n                    }`}\r\n                  >\r\n                    <div className=\"content\">\r\n                      <p>{message.message}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n          <ChatInput handleSendMsg={handleSendMsg} />\r\n        </Container>\r\n      )}\r\n    </>\r\n  );\r\n};\r\nconst Container = styled.div`\r\n  padding-top: 1rem;\r\n  display: grid;\r\n  grid-template-rows: 10% 78% 12%;\r\n  .chat-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 0 2rem;\r\n    .user-details {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 1rem;\r\n      .avatar {\r\n        img {\r\n          height: 3rem;\r\n        }\r\n      }\r\n      .username {\r\n        h3 {\r\n          color: white;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .chat-message {\r\n    padding: 1rem 2rem;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 1rem;\r\n    overflow: auto;\r\n    &::-webkit-scrollbar {\r\n      width: 0.2rem;\r\n      &-thumb {\r\n        background-color: #ffffff39;\r\n        width: 0.1rem;\r\n        border-radius: 1rem;\r\n      }\r\n    }\r\n    .message {\r\n      display: flex;\r\n      align-items: center;\r\n      .content {\r\n        max-width: 40%;\r\n        overflow-wrap: break-word;\r\n        padding: 1rem;\r\n        font-size: 1.1rem;\r\n        border-radius: 1rem;\r\n        color: #d1d1d1;\r\n      }\r\n    }\r\n    .sended {\r\n      justify-content: flex-end;\r\n      .content {\r\n        background-color: #4f04ff21;\r\n      }\r\n    }\r\n    .recieved {\r\n      justify-content: flex-start;\r\n      .content {\r\n        background-color: #9900ff20;\r\n      }\r\n    }\r\n  }\r\n`;\r\nexport default ChatContainer;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}