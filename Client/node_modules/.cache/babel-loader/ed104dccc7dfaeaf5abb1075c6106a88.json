{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";import _regeneratorRuntime from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Adam/Desktop/Apki/chat-box/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _templateObject;import React,{useState,useEffect,useRef}from\"react\";import styled from\"styled-components\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{allUsersRoutes,host}from\"../utils/APIRoutes\";import Contacts from\"./../components/Contacts\";import Welcome from\"../components/Welcome\";import ChatContainer from\"../components/ChatContainer\";import{io}from\"socket.io-client\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(){var socket=useRef();var navigate=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),contacts=_useState2[0],setContacts=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];var _useState5=useState(undefined),_useState6=_slicedToArray(_useState5,2),currentChat=_useState6[0],setCurrentChat=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isLoaded=_useState8[0],setIsLoaded=_useState8[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)){_context.next=4;break;}navigate(\"/login\");_context.next=10;break;case 4:_context.t0=setCurrentUser;_context.next=7;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY));case 7:_context.t1=_context.sent;(0,_context.t0)(_context.t1);setIsLoaded(true);case 10:case\"end\":return _context.stop();}}},_callee);}));return function fetch(){return _ref.apply(this,arguments);};}();fetch();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){if(currentUser){socket.current=io(host);socket.current.emit(\"add-user\",currentUser._id);}},[currentUser]);useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!currentUser){_context2.next=9;break;}if(!currentUser.isAvatarImageSet){_context2.next=8;break;}_context2.next=4;return axios.get(\"\".concat(allUsersRoutes,\"/\").concat(currentUser._id));case 4:data=_context2.sent;setContacts(data.data);_context2.next=9;break;case 8:navigate(\"/setAvatar\");case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function fetch(){return _ref2.apply(this,arguments);};}();fetch();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[currentUser]);var handleChatChange=function handleChatChange(chat){setCurrentChat(chat);};return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(Contacts,{contacts:contacts,changeChat:handleChatChange}),isLoaded&currentChat===undefined?/*#__PURE__*/_jsx(Welcome,{}):/*#__PURE__*/_jsx(ChatContainer,{currentChat:currentChat,socket:socket})]})});};var Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  height: 100vh;\\n  width: 100vw;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  gap: 1rem;\\n  align-items: center;\\n  background-color: #131324;\\n  .container {\\n    height: 85vh;\\n    width: 85vw;\\n    background-color: #00000076;\\n    display: grid;\\n    grid-template-columns: 25% 75%;\\n    @media screen and (min-width: 720px) and (max-width: 1080px) {\\n      grid-template-columns: 35% 65%;\\n    }\\n  }\\n\"])));export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","styled","axios","useNavigate","allUsersRoutes","host","Contacts","Welcome","ChatContainer","io","Chat","socket","navigate","contacts","setContacts","undefined","currentUser","setCurrentUser","currentChat","setCurrentChat","isLoaded","setIsLoaded","fetch","localStorage","getItem","process","env","REACT_APP_LOCALHOST_KEY","JSON","parse","current","emit","_id","isAvatarImageSet","get","data","handleChatChange","chat","Container","div"],"sources":["C:/Users/Adam/Desktop/Apki/chat-box/src/pages/Chat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport axios from \"axios\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { allUsersRoutes, host } from \"../utils/APIRoutes\";\r\nimport Contacts from \"./../components/Contacts\";\r\nimport Welcome from \"../components/Welcome\";\r\nimport ChatContainer from \"../components/ChatContainer\";\r\nimport { io } from \"socket.io-client\";\r\nconst Chat = () => {\r\n  const socket = useRef();\r\n  const navigate = useNavigate();\r\n  const [contacts, setContacts] = useState([]);\r\n  const [currentUser, setCurrentUser] = useState(undefined);\r\n  const [currentChat, setCurrentChat] = useState(undefined);\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetch = async () => {\r\n      if (!localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)) {\r\n        navigate(\"/login\");\r\n      } else {\r\n        setCurrentUser(await JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)));\r\n        setIsLoaded(true);\r\n      }\r\n    };\r\n\r\n    fetch();\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (currentUser) {\r\n      socket.current = io(host);\r\n      socket.current.emit(\"add-user\", currentUser._id);\r\n    }\r\n  }, [currentUser]);\r\n  useEffect(() => {\r\n    const fetch = async () => {\r\n      if (currentUser) {\r\n        if (currentUser.isAvatarImageSet) {\r\n          const data = await axios.get(`${allUsersRoutes}/${currentUser._id}`);\r\n          setContacts(data.data);\r\n        } else {\r\n          navigate(\"/setAvatar\");\r\n        }\r\n      }\r\n    };\r\n    fetch();\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentUser]);\r\n  const handleChatChange = (chat) => {\r\n    setCurrentChat(chat);\r\n  };\r\n  return (\r\n    <Container>\r\n      <div className=\"container\">\r\n        <Contacts\r\n          contacts={contacts}\r\n          changeChat={handleChatChange}\r\n        />\r\n        {isLoaded & (currentChat === undefined) ? (\r\n          <Welcome  />\r\n        ) : (\r\n          <ChatContainer\r\n            currentChat={currentChat}\r\n            socket={socket}\r\n          />\r\n        )}\r\n      </div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nconst Container = styled.div`\r\n  height: 100vh;\r\n  width: 100vw;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  gap: 1rem;\r\n  align-items: center;\r\n  background-color: #131324;\r\n  .container {\r\n    height: 85vh;\r\n    width: 85vw;\r\n    background-color: #00000076;\r\n    display: grid;\r\n    grid-template-columns: 25% 75%;\r\n    @media screen and (min-width: 720px) and (max-width: 1080px) {\r\n      grid-template-columns: 35% 65%;\r\n    }\r\n  }\r\n`;\r\nexport default Chat;\r\n"],"mappings":"whBAAA,MAAOA,MAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,MAArC,KAAmD,OAAnD,CACA,MAAOC,OAAP,KAAmB,mBAAnB,CACA,MAAOC,MAAP,KAAkB,OAAlB,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,cAAT,CAAyBC,IAAzB,KAAqC,oBAArC,CACA,MAAOC,SAAP,KAAqB,0BAArB,CACA,MAAOC,QAAP,KAAoB,uBAApB,CACA,MAAOC,cAAP,KAA0B,6BAA1B,CACA,OAASC,EAAT,KAAmB,kBAAnB,C,wFACA,GAAMC,KAAI,CAAG,QAAPA,KAAO,EAAM,CACjB,GAAMC,OAAM,CAAGX,MAAM,EAArB,CACA,GAAMY,SAAQ,CAAGT,WAAW,EAA5B,CACA,cAAgCL,QAAQ,CAAC,EAAD,CAAxC,wCAAOe,QAAP,eAAiBC,WAAjB,eACA,eAAsChB,QAAQ,CAACiB,SAAD,CAA9C,yCAAOC,WAAP,eAAoBC,cAApB,eACA,eAAsCnB,QAAQ,CAACiB,SAAD,CAA9C,yCAAOG,WAAP,eAAoBC,cAApB,eACA,eAAgCrB,QAAQ,CAAC,KAAD,CAAxC,yCAAOsB,QAAP,eAAiBC,WAAjB,eAEAtB,SAAS,CAAC,UAAM,CACd,GAAMuB,MAAK,4FAAG,wIACPC,YAAY,CAACC,OAAb,CAAqBC,OAAO,CAACC,GAAR,CAAYC,uBAAjC,CADO,yBAEVf,QAAQ,CAAC,QAAD,CAAR,CAFU,0CAIVK,cAJU,uBAIWW,KAAI,CAACC,KAAL,CAAWN,YAAY,CAACC,OAAb,CAAqBC,OAAO,CAACC,GAAR,CAAYC,uBAAjC,CAAX,CAJX,+DAKVN,WAAW,CAAC,IAAD,CAAX,CALU,uDAAH,kBAALC,MAAK,0CAAX,CASAA,KAAK,GACP;AACC,CAZQ,CAYN,EAZM,CAAT,CAcAvB,SAAS,CAAC,UAAM,CACd,GAAIiB,WAAJ,CAAiB,CACfL,MAAM,CAACmB,OAAP,CAAiBrB,EAAE,CAACJ,IAAD,CAAnB,CACAM,MAAM,CAACmB,OAAP,CAAeC,IAAf,CAAoB,UAApB,CAAgCf,WAAW,CAACgB,GAA5C,EACD,CACF,CALQ,CAKN,CAAChB,WAAD,CALM,CAAT,CAMAjB,SAAS,CAAC,UAAM,CACd,GAAMuB,MAAK,6FAAG,uJACRN,WADQ,8BAENA,WAAW,CAACiB,gBAFN,iDAGW/B,MAAK,CAACgC,GAAN,WAAa9B,cAAb,aAA+BY,WAAW,CAACgB,GAA3C,EAHX,QAGFG,IAHE,gBAIRrB,WAAW,CAACqB,IAAI,CAACA,IAAN,CAAX,CAJQ,8BAMRvB,QAAQ,CAAC,YAAD,CAAR,CANQ,wDAAH,kBAALU,MAAK,2CAAX,CAUAA,KAAK,GACP;AACC,CAbQ,CAaN,CAACN,WAAD,CAbM,CAAT,CAcA,GAAMoB,iBAAgB,CAAG,QAAnBA,iBAAmB,CAACC,IAAD,CAAU,CACjClB,cAAc,CAACkB,IAAD,CAAd,CACD,CAFD,CAGA,mBACE,KAAC,SAAD,wBACE,aAAK,SAAS,CAAC,WAAf,wBACE,KAAC,QAAD,EACE,QAAQ,CAAExB,QADZ,CAEE,UAAU,CAAEuB,gBAFd,EADF,CAKGhB,QAAQ,CAAIF,WAAW,GAAKH,SAA5B,cACC,KAAC,OAAD,IADD,cAGC,KAAC,aAAD,EACE,WAAW,CAAEG,WADf,CAEE,MAAM,CAAEP,MAFV,EARJ,GADF,EADF,CAkBD,CA/DD,CAiEA,GAAM2B,UAAS,CAAGrC,MAAM,CAACsC,GAAV,0fAAf,CAoBA,cAAe7B,KAAf"},"metadata":{},"sourceType":"module"}